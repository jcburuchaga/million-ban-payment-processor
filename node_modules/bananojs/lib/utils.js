const BigNumber = require('bignumber.js')
const crypto = require('crypto')

const isBananoAddress = address => /^ban_[13][13456789abcdefghijkmnopqrstuwxyz]{59}$/.test(address)

const fromRaw = raw => {
  const value = BigNumber(raw.toString());
  return value.shiftedBy(-29).toNumber();
}

const toRaw = mvalue => {
  const value = BigNumber(mvalue.toString());
  return value.shiftedBy(29).toString(10);
}

const parseDate = dateString => new Date(parseInt(dateString.padEnd(13, 0)))

const encrypt = (price, msg) => {
  const enc = msg.toUpperCase().split("").reverse().map(char => char.charCodeAt(0)).join("").padStart(26, 0)

  return `${price.toFixed(4)}${enc}`
}

const decrypt = amount => amount
  .slice(-26)
  .match(/.{2}/g)
  .reverse()
  .map(code => String.fromCharCode(code))
  .join("")
  .trim()

const createSeed = (length = 32) => crypto.randomBytes(length).toString('hex')

module.exports = {
  fromRaw,
  toRaw,
  parseDate,
  encrypt,
  decrypt,
  createSeed,
  isBananoAddress,
}
